# Описание приложения.
Данное приложение можно представить как REST API сервис для ресторана.
Приложение позволяет выполнять CRUD операции с сущностями "Меню", "Подменю", "Блюда".
Сущность "Подменю" относится к сущности "Меню". Сущность "Блюдо" относится к сущности "Подменю".

При выдаче списка меню, для каждой позиции меню указывается количество связанных с данной позицией позиций подменю.
При выдаче определенной позиции меню, указывается количество связанных с данной позицией позиций подменю и позиций блюд.
При выдаче списка подменю, для каждой позиции подменю указывается количество связанных с данной позицией позиций блюд.
При выдаче определенной позиции подменю, для данной позиции указывается количество связанных с данной позицией позиций блюд.
При удалении позиции меню, так же удаляются все связанные с данной позицией позиции подменю и позиции блюд.
При удалении позиции подменю, так же удаляются все связанные с данной позицией позиции блюд.
В приложении реализовано кэширование запросов с помощью Redis.
Тесты реализованы с помощью Pytest.
## Дополнительные возможности приложения.
В приложении реализована логика управления данными таблиц базы данных из таблицы с расширением .xlsx.
Данная таблица отражает данные таблиц базы данных данного приложения. При изменении данных таблицы .xlsx, данные изменения вносятся в данные таблиц базы данных данного приложения.
Эта функция приложения реализована как фоновая задача с помощью Celery.
Так же, в приложении есть возможность заполнить таблицы базы данных данными из таблицы с расширением .xlsx. Данная таблица(menu.xlsx) находится в корневой директории.
Помимо этого, есть возможность удалить все данные из всех таблиц базы данных.
Приложение можно запустить в Docker. Тесты, так же можно запустить в Docker.
## Технологии, примененные в проекте.
Приложение написано на FastAPI с использованием синтаксиса async/await.
В качестве базы СУБД используется PostgreSQL.
Миграции базы данных реализованы с помощью alembic.
В качестве менеджера зависимостей, в данном приложении используется Poetry.
Тесты написаны на Pytest.
Реализовано кэширование запросов с помощью Redis(инвалидация кэша по времени).
В приложении присутсвует фоновая задача(мониторинг изменений данных приложения из таблицы с расширением .xlsx). Выполняется данная задача с помощью Celery.
В качестве брокера сообщений для Celery, используется RabbitMQ.
Приложение можно запустить в Docker. Тесты, так же можно запустить в Docker.
# Описание структуры приложения.
## Зависимости.
Зависимости находятся в файле "pyproject.toml" в корневой директории.
## Логика управления данными таблиц базы данных.
Логика управления данными таблиц базы данных расположена в "/app/data_sources/storages".
В "/app/data_sources/storage/menu_repository.py" расположен репозиторий для сущности "Меню", в "/app/data_sources/storage/submenu_repository.py" расположен репозиторий
для сущности "Подменю", в "/app/data_sources/storage/dish_repository.py" расположен репозиторий для сущности "Блюда".
## Обработчики запросов.
Обработчики запросов располагаются в /app/views.
В "/app/views/crud_for_menu.py" расположены обработчики запросов для сущности "Меню", в "/app/views/crud_for_submenu.py" расположены обработчики запросов для сущности "Подменю",
в "/app/views/crud_for_dish.py" расположены обработчики запросов для сущности "Блюда".
## Конфигурация приложения.
Конфигурация приложения расположена в "/app/config.py".
Конфигурация для работы тестов, находится в "/tests/conftest.py".
Переменные окружения, необходимые для работы приложения локально, находятся в файле ".env" в корневой директории.
Переменные окружения, необходимые для работы приложения в Docker, находятся в файле ".env-non-dev" в корневой директории.
Переменные окружения, необходимые для работы тестов в Docker, находятся в файле "env-tests" в корневой директории.
## Модели таблиц баз данных.
Модели таблиц базы данных расположены в файле "/app/data_sources/models.py".
## Миграции базы данных.
Миграции базы данных расположены в "/app/migrations/versions".
## Файл запуска приложения.
Приложение запускается из файла "/app/main.py".
## Мониторинг изменения данных таблиц базы данных.
Логика реализации мониторинга изменений данных таблиц базы данных расположена в файле "/app/table_monitoring.py".
## Заполнение таблиц базы данных данными из таблицы с расширением .xlsx.
Логика заполнения таблиц базы данных данными из таблицы с расширением .xlsx расположена в файле "/app/database_entry.py".
## Отчищение таблиц базы данных.
Логика отчищения таблиц базы данных находится в файле "/app/clear_database.py".
## Баш скрипты.
Баш скрипты, необходимы для работы приложения в Docker, расположены в "/scripts_for_docker".
Баш скрипты, необходимы для работы приложения в Docker, расположены в "/scripts_for_docker/app.sh".
Баш скрипты, необходимы для работы тестов в Docker, расположены в "/scripts_for_docker/tests.sh".
## Тесты.
Тесты для данного приложения располагаются в директории "/tests".
# Подготовка к запуску приложения локально.
Для запуска приложения локально, необходимы запущенные сервер PostgreSQL, сервер Redis, сервер брокера сообщений. В данном приложении, в качестве брокера сообщений используется RabbitMQ.
## Подключение к базе данных.
В данном приложении, в качестве СУБД используется PostgreSQL.
Для подключения к базе данных, сначала нужно установить значения для переменных окружения, которые располагаются в файле ".env" в корневой директории.
Необходимо установить значения для следующих переменных:
- DB_USER- имя пользователя базы данных,
- PASSWORD- пароль для базы данных,
- DB_HOST- имя хоста базы данных,
- DB_NAME- имя базы данных,
- DB_PORT- порт базы данных.
После установки данных значений, необходимо выполнить миграцию таблиц базы данных.
Для выполнения миграции таблиц базы данных, необходимо выполнить команду "alembic upgrade head" в терминале из корневой директории.
## Подключение к Redis.
Для подключения к Redis, необходимо установить значения для переменных окружения, которые располагаются в файле ".env" в корневой директории.
Необходимо установить значения для следующих переменных окружения:
- REDIS_HOST- имя хоста Redis,
- REDIS_PORT- порт Redis.
## Установка хоста и порта приложения.
Для работы приложения локально, необходимо установить значения для следующих переменных окружения, которые располагаются в файле ".env" в корневой директории:
- APP_HOST- имя хоста, на котором будет запущено приложение,
- APP_PORT- порт, для запуска приложения.
## Конфигурайия для запуска фоновой задачи и заполнения базы данных из таблицы с расширением .xlsx.
Для запуска фоновой задачи(мониторинг изменения данных таблиц базы данных), необходиомо указать URL брокера сообщений.
Так же, для запуска фоновой задачи, нужно указать абсолютный путь до таблицы с расширением .xlsx, изменения данных которой,
будут влиять на изменение данных таблиц базы данных. Путь до данной таблицы .xlsx, так же необходим для реализации заполнения
таблиц базы данных, данными из этой таблицы.
Так же для выполнения фоновой задачи, необходимо укзать частоту проверки состояния таблицы .xlsx.
В общем, нужно установить значения для следующих переменных окружения, которые распологаются в файле ".env" в корневой директории:
- PATH_TO_TABLE- абсолютный путь до таблицы с расширением .xlsx,
- BROKER_URL- URL брокера сообщений(RabbitMQ),
- CHECK_INTERVAL- частота проверки состояния таблицы .xlsx.
## Запуск приложения локально.
Перед запуском приложения, необходимо установить зависимости, после чего нужно активировать виртуальное окружение.
### Установка зависимостей.
Для установки зависимостей, необходимо выполнить команду
"poetry install" в терминале из корневой директории.
### Активация виртуального окркжения.
Для активации виртуального окружения, необходимо выполнить команду "poetry shell" из корневой директории.
## Запуск приложения.
Чтобы запустить приложение локально, нужно выполнить команду
"python main.py" в терминале из
директории "/app".
## Взаимодействие с приложением.
Взаимодействовать с приложением можно, перейдя по ссылке "127.0.0.1:8000/docs".
Этот адрес может быть изменен, при изменении соответствующих переменных окружения, распологающихся в файле ".env" в корневой директории.
По данной ссылке будет доступна автодокументация приложения.
Так же с приложением можно взаимодействовать с помощью Postman.
## Запуск фоновой задачи.
Для запуска фоновой задачи, сначала нужно установить значения для следующих переменных окружения:
- PATH_TO_TABLE- абсолютный путь до таблицы с расширением .xlsx,
- BROKER_URL- URL брокера сообщений,
- CHECK_INTERVAL- частота проверки состояния таблицы .xlsx.
В данном приложении, в качестве брокера сообщений используется RabbitMQ. Но может использоваться какой-либо другой брокер сообщений.
Данные переменные окружения расположены в файле ".env" в корневой директории.
Для запуска фоновой залачи, необходимо выполнить команду
"celery -A table_monitoring:celery worker" из директории "/app".
После запуска фоновой задачи, при внесении изменений в данные, соответствующей таблицы с расширением .xlsx, соответствующие изменения данных произойдут и в тпблицах базы данных данного приложения.
# Запуск приложения в Docker.
## Подготовка к запуску приложения в Docker.
Переменные окружения, необходимые для запуска приложения в Docker, распологаются в файле "env-non-dev" в корневой директории.
Для запуска приложения в Docker, необходимо установить значения, для следующих переменных окружения:
  - POSTGRES_DB- имя базы данных;
  - POSTGRES_USER- имя пользователя базы данных;
  - POSTGRES_PASSWORD- пароль базы данных
  - REDIS_HOST- имя хоста сервера Redis;
  - REDIS_PORT- порт сервера Redis;
  - APP_HOST- хост для запуска приложения;
  - APP_PORT- порт для запуска приложения.
Для запуска приложения в Docker, сначала нужно собрать контейнеры и потом выполнить запуск контейнеров.
Для сборки контейнеров, необходимо выполнить команду
"docker compose build" в терминале из корневой директории.
Для запуска приложения в Docker, необходимо выполнить команду
"docker compose up app" в терминале из корневой директории.
С приложением можно взаимодействовать, перейдя по ссылке "имя хоста:порт/docs".
По этой ссылке будет доступна автодокументация приложения.
# Тестирование приложения.
Тесты для данного приложения можно запустить как локально так и в Docker.
## Подготовка к запуску тестов локально.
Для запуска тестов локально, сначала необходимо установить зависимости и активировать виртуальное окружение. После чего нужно установить значения для переменных окружения, которые располагаются в файле ".env" в корневой директории.
Для установки зависимостей, необходимо выполнить команду
"poetry install" в терминале из корневой директории.
Для активации виртуального окружения, необходимо выполнить команду "poetry shell" в терминале из корневой директории.
Необходимо установить значения для следующих переменных окружения:
  - DB_USER- имя пользователя тестовой базы данных;
  - PASSWORD- пароль для тестовой базы данных;
  - DB_HOST- имя хоста тестоаой базы данных.
  - DB_TEST_PORT- порт тестовой базы данных;
  - TEST_DB_NAME- имя тестовой базы данных;
  - REDIS_HOST- имя хоста сервера Redis;
  - REDIS_PORT- порт сервера Redis;
  - APP_HOST- хост для запуска приложения;
  - APP_PORT- порт для запуска приложения.
Для запуска тестов локально, необходимы запущенные серверы PostgreSQL и Redis.
### Запуск тестов локально.
Для запуска тестов локально, необходимо выполнить команду
"pytest tests/" из корневой директории.
## Подготовка к запуску тестов в Docker.
Для запуска тестов в Docker, сначала необходимо установить значения для переменных окружения, которые находятся в файле ".env-tests" в корневой директории.
Нужно установить значения для следующих переменных окружения:
  - POSTGRES_DB- имя тестовой базы данных;
  - POSTGRES_USER- имя пользователя тестовой базы данных;
  - POSTGRES_PASSWORD- пароль для тестовой базы данных;
  - REDIS_HOST- имя хоста сервера Redis;
  - REDIS_PORT- порт сервера Redis;
  - APP_HOST- хост для запуска приложения;
  - APP_PORT- порт для запуска приложения.
## Запуск тестов в Docker.
Для запуска тесов в Docker, сначала нужно выполнить сборку контейнеров, после чего необходимо запустить контейнеры.
Для сборки контейнеров, необходимо выполнить команду
"docker compose build" в терминале из корневой директории.
Для запуска тестов в Docker необходимо выполнить команду
"docker compose up tests" в терминале из корневой директории.






